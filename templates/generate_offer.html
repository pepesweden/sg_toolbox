<!DOCTYPE html>
<html lang="sv">
    <head>
        <meta charset="UTF-8">
        <title>Offet generator</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    </head>
    
    <body class="bg-light">
      <div class="d-flex justify-content-center align-items-center gap-4 mb-4">
        <a href="{{ url_for('welcome_page') }}">
            <img src="{{ url_for('static', filename='logo/white.png') }}" alt="Logotyp" height="60">
        </a>
        <a href="{{ url_for('welcome_page') }}">
            <img src="{{ url_for('static', filename='logo/house-icon.png') }}" alt="Hem" height="40">
        </a>
      </div>
      <div class="container mt-5">
        <div class="module-blurb">
          <h1>Säljverktyg</h1>
        </div>
      </div>
      <div class="text-center mb-4">
            <h1 class="display-5">Säljverktyg</h1>
        </div>
        <div class="container mt-5">
          <div class="module-blurb">
            <div class="blurb-container" style="display: flex; gap: 20px; flex-wrap: wrap;">
              <!-- Leadgen -->
              <div class="blurb" onclick="showForm('leadgen')" style="flex: 1; border: 1px solid #ccc; padding: 20px; border-radius: 12px; cursor: pointer;">
                <div class="blurb-icon-container">
                  <i class="fas fa-file-alt"></i>
                </div>
                <h3>Lead tracker</h3>
                <p>Följ status på annonser, när de är publicerade och avpublicerade samt antal dagar</p>
              </div>

              <!-- Offert -->
              <div class="blurb" onclick="showForm('offert')" style="flex: 1; border: 1px solid #ccc; padding: 20px; border-radius: 12px; cursor: pointer;">
                <h3>📄 Offert</h3>
                <p>Generera en offert enligt Salesgroup-mallen.</p>
              </div>

              <!-- Annat -->
              <div class="blurb" onclick="showForm('other')" style="flex: 1; border: 1px solid #ccc; padding: 20px; border-radius: 12px; cursor: pointer;">
                <h3>👥 Annat</h3>
                <p>Annnan funktion.</p>
              </div>
            </div>
          </div>
          <div class="module-blurb">  
              <!--<h1>Leads tracker</h1>-->
              <div id="leadgen-form" class="form-section" style="display: none;">
                <div class="card p-4 mb-4 bg-white shadow-sm">
                  <h3>📄 Leads tracker (under uppbyggnad)</h3>
                  <p>Följ dina leads.</p>
                  <div id="delta-output" class="mt-3" style="font-family: monospace;"></div>
                </div>
              </div>

              <!--<h1>Skapa offert </h1>-->
              <div id="offert-form" class="form-section" style="display: none;">
                <div class="card p-4 mb-4 bg-white shadow-sm">
                  <h3>📄 Offertgenerering - Kommer (troligtvis inte) snart</h3>
                  <p>Här kommer du nog aldrig kunna gerenera offerter 😉</p>
                </div>
              </div>


              <!-- Referenssammanfattning endpoint-->
              <div id="other-form" class="form-section" style="display: none;">
                <div class="card p-4 mb-4 bg-white shadow-sm">
                  <h3>👥 Annat</h3>
                  <p>Här kan man göra annat om man har lust.</p>
                </div>
              </div>
          </div>
        </div>
      <script>
          function showForm(type) {
            // Dölj alla formulär
            document.querySelectorAll('.form-section').forEach(div => {
              div.style.display = 'none';
            });

            // Visa det valda formuläret
            const target = document.getElementById(type + '-form');
            if (target) {
              target.style.display = 'block';

              // Anropa rätt funktion om du klickade på "leadgen"
              if (type === 'leadgen') {
                loadLeadDelta();  // 👈 Nu fungerar det!
              }
            }
          }

          // ✅ Nu ligger funktionen utanför showForm()
          function loadLeadDelta() {
            fetch("http://localhost:5050/leadgen/delta-json")
              .then(response => response.json())
              .then(data => {
                let html = "<h4>Jobbförändringar senaste 60 dagarna</h4><pre>";
                data.forEach(job => {
                  let emoji = {
                    "NEW": "🟦",
                    "ACTIVE": "✅",
                    "REMOVED": "❌"
                  }[job.status] || "";

                  html += `${emoji} [${job.status.padEnd(8)}] ${job.role.padEnd(45)} - ${job.company} (${job.date})\n`;
                });
                html += "</pre>";
                document.getElementById("delta-output").innerHTML = html;
              })
              .catch(err => {
                document.getElementById("delta-output").innerHTML = "<p style='color:red;'>Kunde inte läsa data från leadgen-tjänsten.</p>";
              });
          }
      </script>

    </body>
</html>
